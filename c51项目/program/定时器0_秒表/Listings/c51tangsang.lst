C51 COMPILER V9.54   C51TANGSANG                                                           11/17/2022 12:49:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE C51TANGSANG
OBJECT MODULE PLACED IN .\Objects\hex\c51tangsang.obj
COMPILER INVOKED BY: D:\software\keil5\C51\BIN\C51.EXE Objects\code\c51tangsang.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTE
                    -XTEND PRINT(.\Listings\c51tangsang.lst) OBJECT(.\Objects\hex\c51tangsang.obj)

line level    source

   1          
   2          #include "c51tangsang.h"
   3          
   4          /*
   5           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   6           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   7           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   8           */
   9          
  10          
  11          
  12          //ÑÓÊ±º¯Êý
  13          //unsigned int ms²ÎÊýµ¥Î»ºÁÃë 
  14          void delay(unsigned int ms)
  15          {
  16   1              unsigned char i, j;
  17   1              while(ms--)
  18   1              {       
  19   2                      i = 12;
  20   2                      j = 169;
  21   2                      do
  22   2                      {
  23   3                              while (--j);
  24   3                      } while (--i);
  25   2              }
  26   1      }
  27          //°ËÎ»ÊýÂë¹ÜÖ¸¶¨Î»ÖÃÏÔÊ¾Êý×Ö
  28          //ºóÆÚ¿ÉÀ©Õ¹ÎªÖÇÄÜÏÔÊ¾×ÖÄ¸»òÊý×Ö£¬or DIYÏÔÊ¾ 
  29          void show_digital(unsigned int th,unsigned int digital)
  30          {
  31   1              //¸øÒ»¸öÊý×é´æ·ÅÄÜ¹»ÏÔÊ¾µÄËùÓÐÊý×Ö£¬ºóÆÚ¸ø×ÖÄ¸»»Ò»¸ö±í´æ·Å
  32   1              //´Ë´¦´æÔÚÄÚ´æÔ½½çµÄÇé¿ö£¬Ó¦ÅÐ¶Ï´«ÈëµÄ²ÎÊýÊÇ·ñÔÚ¹æ¶¨ÊýÂë¹ÜÊýÁ¿ÄÚ£¬³¬³öÔòÏÔÊ¾¹æ¶¨ÄÚÈÝ£¬Ö÷ÒªÊÇ³ÌÐòÔ±×Ô¼ºµ÷Ê
             -Ô³ÌÐòµÄÊ±ºò»á³öÏÖÏÂ±êÔ½½ç
  33   1              //ºóÆÚÒ²¿ÉÒÔÍ¨¹ý°´Å¥ÊµÏÖÊýÂë¹ÜÏÔÊ¾ÏàÓ¦µÄÄÚÈÝ
  34   1              //»òÕßÍ¨¹ý°´Å¥ÏÔÊ¾Ïà¶ÔÓ¦µÄÊý×Ö 
  35   1              //0-9 
  36   1              unsigned char code digital_table[]={0xc0,0xf9,0xa4,0xb0, 
  37   1                                                                                                                                                              0x99,0x92,0x82,0xf8,  
  38   1                                                                                                                                                              0x80,0x90,0x88,0x83, 
  39   1                                                                                                                                                              0xc6,0xa1,0x86,0x8e};
  40   1              switch(th)
  41   1              {                                                                                                                                               //    P2_4 P2_3 P2_2
  42   2                      case 8:P2_2=0;P2_3=0;P2_4=0;break;// 1. 1                       1               1
  43   2                      case 4:P2_2=0;P2_3=0;P2_4=1;break;// 2. 1                       1                       0
  44   2                      case 6:P2_2=0;P2_3=1;P2_4=0;break;// 3. 1               0               1
  45   2                      case 2:P2_2=0;P2_3=1;P2_4=1;break;// 4. 1               0               0
  46   2                      case 7:P2_2=1;P2_3=0;P2_4=0;break;// 5. 0               1               1
  47   2                      case 3:P2_2=1;P2_3=0;P2_4=1;break;// 6. 0               1               0
  48   2                      case 5:P2_2=1;P2_3=1;P2_4=0;break;// 7. 0               0               1
  49   2                      case 1:P2_2=1;P2_3=1;P2_4=1;break;// 8. 0               0               0
  50   2                      //Ä¬ÈÏÔÝÊ±ÏÈÓÃ1´úÌæ
  51   2                      default:P2_2=0;P2_3=0;P2_4=0;P0=digital_table[digital];
  52   2              }
  53   1              //ÉÏÃæµÄ×ÖÂëÊÇ¹²Ñô¼«µÄ£¬ËùÒÔÖ±½ÓÈ¡·´£¬ÀÁµÃÐ´×ÖÂë£¬Ö±½Ó°Ù¶ÈµÄ£¬½á¹û·¢ÏÖÊÇ¹²Ñô¼« µÄ£¬³±¡£
C51 COMPILER V9.54   C51TANGSANG                                                           11/17/2022 12:49:26 PAGE 2   

  54   1              P0=~digital_table[digital];
  55   1              delay(1);
  56   1              //Ïû¸ö¶¶
  57   1              
  58   1      }
  59          
  60          static void write_byte(unsigned char byte)
  61          {
  62   1              unsigned char i;
  63   1              //°ÑÊý¾Ý·Å½ø¼Ä´æÆ÷£¬¼Ä´æÆ÷Îª²»¿ÉÎ»²Ù×÷¼Ä´æÆ÷ÀûÓÃ& |Ñ¹Õ»Ê½¸³Öµ
  64   1              for(i=0;i<8;i++)
  65   1              {
  66   2                      //°Ñ×î¸ßÎ»È¡³öÀ´
  67   2                      SER =byte>>7;
  68   2                      byte<<=1;
  69   2                      //Ê±ÖÓºÍrck¸Ã¸´Ï°ÁË
  70   2                      SRCK =0;
  71   2                      SRCK =1;
  72   2              }
  73   1              //ÐèÒªÒ»¸öÉÏÉýÑØ²ÅÄÜ´«ÈëÊý¾Ý
  74   1              RCK =1;
  75   1              //´«ÈëÊý¾ÝºóÈÃio±£³ÖµÍµçÆ½£¬ÎªÏÂÒ»´Î´«ÈëÊý¾Ý×ö×¼±¸(ÏÂÒ»´ÎÉÏÉýÑØ)
  76   1              RCK =0;
  77   1      }
  78          
  79          
  80          void show_clum(unsigned char clum,unsigned char Data)
  81          {
  82   1              write_byte(Data);
  83   1              P0=~(0x80>>(clum-1));
  84   1              //ÁÐÎª¹²Òõ¼«¸ø0Ñ¡ÖÐ
  85   1      }
  86          
  87          //ÑÓÊ±º¯Êý£¬µ¥Î»£ºus
  88          void delayus(unsigned int j)            //@12.000MHz
  89          {
  90   1              unsigned char i;
  91   1              while(j--)
  92   1              {
  93   2                      i = 2;
  94   2                      while (--i);
  95   2              }
  96   1      }
  97          
  98          // uint i --->·äÃùÆ÷Ò»´ÎÉùÏìµÄ³¤¶È
  99          void beep(uint i)
 100          {
 101   1                      while(i--)
 102   1                      {
 103   2                              P2_5=0;
 104   2                              delayus(20);//¸ßµçÆ½µÄÕ¼ÓÃÊ±¼äÔ½³¤·äÃùÆ÷µÄÒôµ÷Ô½¸ß£¬
 105   2                              P2_5=1;
 106   2                              delayus(10);
 107   2                      }
 108   1      }
 109          void time_0_ms_init()
 110          {
 111   1              //TMOD = 0x01;//¹¤×÷Ä£Ê½£¬²»¿ÉÎ»Ñ°Ö·£¬Ã¿Ò»¸öÎ»¶¼ÓÐÏàÓ¦µÄº¬Òå£¬
 112   1              TMOD&=0xF0;//ÉÏÃæµÄÐ´·¨¿ÉÄÜ´æÔÚÓëÁíÒ»¸ö¶¨Ê±Æ÷³åÍ»µÄÇé¿ö£»
 113   1              TMOD|=0x01;//ÓÃ&|µÄ·½Ê½¸³Öµ²»»áÓ°ÏìÁíÒ»¸ö¶¨Ê±Æ÷µÄÔËÐÐ
 114   1              TF0=0;//Ä¬ÈÏÓ¦¸ÃÊÇ0²»ÅäÖÃ²»Ó°Ïì£¬±ÜÃâÒ»¿ªÊ¼¾Í²úÉúÖÐ¶Ï;
 115   1              TH0=64535/256;//¸ß°ËÎ»Êý¾Ý     ¾§Õñ12mhz£¬Ò»¸öÖÜÆÚÎª1us£¬×î´ó65535us£¬
C51 COMPILER V9.54   C51TANGSANG                                                           11/17/2022 12:49:26 PAGE 3   

 116   1              TL0=64535%256;//µÍ°ËÎ»Êý¾Ý->64535 = 65535-1000; -> 1000us=1ms; ¶¨Ê±Æ÷µ¥Î»Îª1ms
 117   1              ET0=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 118   1              EA=1;
 119   1              PT0=0;
 120   1      }
 121          
 122          void time_1_ms_init()
 123          {
 124   1              TMOD&=0x0F;
 125   1              TMOD|=0x10;
 126   1              TL1=64535%256;
 127   1              TH1=64535/256;
 128   1              TF1=0;//ÉèÖÃÄ¬ÈÏÎªÎ´Òç³ö        
 129   1      
 130   1      //      IE1=1;//ÖÐ¶Ï¿ª¹Ø
 131   1      //      IT1=1;
 132   1              
 133   1              ET1=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 134   1              EA=1;
 135   1              PT1=0;
 136   1              
 137   1              TR1=1;//¶¨Ê±Æ÷1¿ªÊ¼ÔËÐÐ
 138   1      }
 139          
 140          void time_1_us_init()
 141          {
 142   1              TMOD&=0x0F;
 143   1              TMOD|=0x10;
 144   1              TL1=65534%256;
 145   1              TH1=65534/256;
 146   1              TF1=0;//ÉèÖÃÄ¬ÈÏÎªÎ´Òç³ö        
 147   1      
 148   1      //      IE1=1;//ÖÐ¶Ï¿ª¹Ø
 149   1      //      IT1=1;
 150   1              
 151   1              ET1=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 152   1              EA=1;
 153   1              PT1=0;
 154   1              
 155   1              TR1=1;//¶¨Ê±Æ÷1¿ªÊ¼ÔËÐÐ
 156   1      }
 157          
 158          void time_0_us_init()
 159          {
 160   1              //TMOD = 0x01;//¹¤×÷Ä£Ê½£¬²»¿ÉÎ»Ñ°Ö·£¬Ã¿Ò»¸öÎ»¶¼ÓÐÏàÓ¦µÄº¬Òå£¬
 161   1              TMOD&=0xF0;//ÉÏÃæµÄÐ´·¨¿ÉÄÜ´æÔÚÓëÁíÒ»¸ö¶¨Ê±Æ÷³åÍ»µÄÇé¿ö£»
 162   1              TMOD|=0x01;//ÓÃ&|µÄ·½Ê½¸³Öµ²»»áÓ°ÏìÁíÒ»¸ö¶¨Ê±Æ÷µÄÔËÐÐ
 163   1              TF0=0;//Ä¬ÈÏÓ¦¸ÃÊÇ0²»ÅäÖÃ²»Ó°Ïì£¬±ÜÃâÒ»¿ªÊ¼¾Í²úÉúÖÐ¶Ï;
 164   1              TH0=65534/256;//¸ß°ËÎ»Êý¾Ý     ¾§Õñ12mhz£¬Ò»¸öÖÜÆÚÎª1us£¬×î´ó65535us£¬
 165   1              TL0=65534%256;//µÍ°ËÎ»Êý¾Ý->64535 = 65535-1000; -> 1000us=1ms; ¶¨Ê±Æ÷µ¥Î»Îª1ms
 166   1              ET0=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 167   1              EA=1;
 168   1              PT0=0;
 169   1      }
 170          
 171          //¶ÁÈ¡¶ÀÁ¢°´¼ü×´Ì¬
 172          uint buttom_getstate_4()
 173          {
 174   1              if(P3_0==0)
 175   1              {
 176   2                      delay(20);while(P3_0==0);delay(20);return 2;
 177   2              }
C51 COMPILER V9.54   C51TANGSANG                                                           11/17/2022 12:49:26 PAGE 4   

 178   1              if(P3_1==0)
 179   1              {
 180   2                      delay(10);while(P3_1==0);delay(20);return 1;
 181   2              }
 182   1              if(P3_2==0)
 183   1              {
 184   2                      delay(10);while(P3_2==0);delay(20);return 3;
 185   2              }
 186   1              if(P3_3==0)
 187   1              {
 188   2                      delay(10);while(P3_3==0);delay(20);return 4;
 189   2              }
 190   1              return 0;
 191   1      }
 192          
 193          int buttom_getstate_16()
 194          {
 195   1          int state=0;
 196   1          P1=0xFF;
 197   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 198   1          P1_3=0;
 199   1          //¾ØÕó¼üÅÌµÚÒ»ÁÐ--->ÅÐ¶Ï×î×ó±ßÁÐ
 200   1          if(P1_7==0){ delay(50);while(P1_7==0);delay(20);state=1;}
 201   1          if(P1_6==0){ delay(50);while(P1_7==0);delay(20);state=5;}
 202   1          if(P1_5==0){ delay(50);while(P1_7==0);delay(20);state= 9;}
 203   1          if(P1_4==0){ delay(50);while(P1_7==0);delay(20);state= 13;}
 204   1      
 205   1          P1=0xFF;
 206   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 207   1          P1_2=0;
 208   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0100
 209   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 2;}
 210   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 6;}
 211   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 10;}
 212   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 14;}
 213   1      
 214   1          P1=0xFF;
 215   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 216   1          P1_1=0;
 217   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0010
 218   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 3;}
 219   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 7;}
 220   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 11;}
 221   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 15;}
 222   1      
 223   1          P1=0xFF;
 224   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 225   1          P1_0=0;
 226   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0001
 227   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 4;}
 228   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 8;}
 229   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 12;}
 230   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 16;}
 231   1      
 232   1          return state;
 233   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    748    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.54   C51TANGSANG                                                           11/17/2022 12:49:26 PAGE 5   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
