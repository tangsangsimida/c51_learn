C51 COMPILER V9.54   C51TANGSANG                                                           02/16/2023 23:16:31 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE C51TANGSANG
OBJECT MODULE PLACED IN .\Objects\hex\c51tangsang.obj
COMPILER INVOKED BY: D:\software\keil5\C51\BIN\C51.EXE code\c51tangsang.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PR
                    -INT(.\Listings\c51tangsang.lst) OBJECT(.\Objects\hex\c51tangsang.obj)

line level    source

   1          
   2          #include "c51tangsang.h"
   3          
   4          /*
   5           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   6           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   7           *¸Ã¿âÎªtangsangÇ×ÊÖ´òÔì£¬ÈË¹¤´òÔì£¬±È½Ï´Ö²Ú£¬¹¦ÄÜÇ·È±»òè¦´Ã£¬½öÌá¹©Ñ§Ï°²Î¿¼ 
   8           */
   9          
  10          
  11          
  12          //ÑÓÊ±º¯Êý
  13          //unsigned int ms²ÎÊýµ¥Î»ºÁÃë 
  14          void delay(unsigned int ms)
  15          {
  16   1              unsigned char i, j;
  17   1              while(ms--)
  18   1              {       
  19   2                      i = 12;
  20   2                      j = 169;
  21   2                      do
  22   2                      {
  23   3                              while (--j);
  24   3                      } while (--i);
  25   2              }
  26   1      }
  27          //°ËÎ»ÊýÂë¹ÜÖ¸¶¨Î»ÖÃÏÔÊ¾Êý×Ö
  28          //ºóÆÚ¿ÉÀ©Õ¹ÎªÖÇÄÜÏÔÊ¾×ÖÄ¸»òÊý×Ö£¬or DIYÏÔÊ¾ 
  29          void show_digital(unsigned int th,unsigned int digital)
  30          {
  31   1              //¸øÒ»¸öÊý×é´æ·ÅÄÜ¹»ÏÔÊ¾µÄËùÓÐÊý×Ö£¬ºóÆÚ¸ø×ÖÄ¸»»Ò»¸ö±í´æ·Å
  32   1              //´Ë´¦´æÔÚÄÚ´æÔ½½çµÄÇé¿ö£¬Ó¦ÅÐ¶Ï´«ÈëµÄ²ÎÊýÊÇ·ñÔÚ¹æ¶¨ÊýÂë¹ÜÊýÁ¿ÄÚ£¬³¬³öÔòÏÔÊ¾¹æ¶¨ÄÚÈÝ£¬Ö÷ÒªÊÇ³ÌÐòÔ±×Ô¼ºµ÷Ê
             -Ô³ÌÐòµÄÊ±ºò»á³öÏÖÏÂ±êÔ½½ç
  33   1              //ºóÆÚÒ²¿ÉÒÔÍ¨¹ý°´Å¥ÊµÏÖÊýÂë¹ÜÏÔÊ¾ÏàÓ¦µÄÄÚÈÝ
  34   1              //»òÕßÍ¨¹ý°´Å¥ÏÔÊ¾Ïà¶ÔÓ¦µÄÊý×Ö 
  35   1              //0-9 
  36   1              unsigned char code digital_table[]={0xc0,0xf9,0xa4,0xb0, 
  37   1                                                                                                                                                              0x99,0x92,0x82,0xf8,  
  38   1                                                                                                                                                              0x80,0x90,0x88,0x83, 
  39   1                                                                                                                                                              0xc6,0xa1,0x86,0x8e};
  40   1              switch(th)
  41   1              {                                                                                                                                               //    P2_4 P2_3 P2_2
  42   2                      case 8:P2_2=0;P2_3=0;P2_4=0;break;// 1. 1                       1               1
  43   2                      case 4:P2_2=0;P2_3=0;P2_4=1;break;// 2. 1                       1                       0
  44   2                      case 6:P2_2=0;P2_3=1;P2_4=0;break;// 3. 1               0               1
  45   2                      case 2:P2_2=0;P2_3=1;P2_4=1;break;// 4. 1               0               0
  46   2                      case 7:P2_2=1;P2_3=0;P2_4=0;break;// 5. 0               1               1
  47   2                      case 3:P2_2=1;P2_3=0;P2_4=1;break;// 6. 0               1               0
  48   2                      case 5:P2_2=1;P2_3=1;P2_4=0;break;// 7. 0               0               1
  49   2                      case 1:P2_2=1;P2_3=1;P2_4=1;break;// 8. 0               0               0
  50   2                      //Ä¬ÈÏÔÝÊ±ÏÈÓÃ1´úÌæ
  51   2                      default:P2_2=0;P2_3=0;P2_4=0;P0=digital_table[digital];
  52   2              }
  53   1              //ÉÏÃæµÄ×ÖÂëÊÇ¹²Ñô¼«µÄ£¬ËùÒÔÖ±½ÓÈ¡·´£¬ÀÁµÃÐ´×ÖÂë£¬Ö±½Ó°Ù¶ÈµÄ£¬½á¹û·¢ÏÖÊÇ¹²Ñô¼« µÄ£¬³±¡£
C51 COMPILER V9.54   C51TANGSANG                                                           02/16/2023 23:16:31 PAGE 2   

  54   1              P0=~digital_table[digital];
  55   1              delay(1);
  56   1              //Ïû¸ö¶¶
  57   1              
  58   1      }
  59          
  60          static void write_byte(unsigned char byte)
  61          {
  62   1              unsigned char i;
  63   1              //°ÑÊý¾Ý·Å½ø¼Ä´æÆ÷£¬¼Ä´æÆ÷Îª²»¿ÉÎ»²Ù×÷¼Ä´æÆ÷ÀûÓÃ& |Ñ¹Õ»Ê½¸³Öµ
  64   1              for(i=0;i<8;i++)
  65   1              {
  66   2                      //°Ñ×î¸ßÎ»È¡³öÀ´
  67   2                      SER =byte>>7;
  68   2                      byte<<=1;
  69   2                      //Ê±ÖÓºÍrck¸Ã¸´Ï°ÁË
  70   2                      SRCK =0;
  71   2                      SRCK =1;
  72   2              }
  73   1              //ÐèÒªÒ»¸öÉÏÉýÑØ²ÅÄÜ´«ÈëÊý¾Ý
  74   1              RCK =1;
  75   1              //´«ÈëÊý¾ÝºóÈÃio±£³ÖµÍµçÆ½£¬ÎªÏÂÒ»´Î´«ÈëÊý¾Ý×ö×¼±¸(ÏÂÒ»´ÎÉÏÉýÑØ)
  76   1              RCK =0;
  77   1      }
  78          
  79          
  80          void show_clum(unsigned char clum,unsigned char Data)
  81          {
  82   1              write_byte(Data);
  83   1              P0=~(0x80>>(clum-1));
  84   1              //ÁÐÎª¹²Òõ¼«¸ø0Ñ¡ÖÐ
  85   1      }
  86          
  87          //ÑÓÊ±º¯Êý£¬µ¥Î»£ºus
  88          void delayus(unsigned int j)            //@12.000MHz
  89          {
  90   1              unsigned char i;
  91   1              while(j--)
  92   1              {
  93   2                      i = 2;
  94   2                      while (--i);
  95   2              }
  96   1      }
  97          
  98          // uint i --->·äÃùÆ÷Ò»´ÎÉùÏìµÄ³¤¶È
  99          void beep(uint i)
 100          {
 101   1                      while(i--)
 102   1                      {
 103   2                              P2_5=0;
 104   2                              delayus(20);//¸ßµçÆ½µÄÕ¼ÓÃÊ±¼äÔ½³¤·äÃùÆ÷µÄÒôµ÷Ô½¸ß£¬
 105   2                              P2_5=1;
 106   2                              delayus(10);
 107   2                      }
 108   1      }
 109          void time_0_ms_init()
 110          {
 111   1              //TMOD = 0x01;//¹¤×÷Ä£Ê½£¬²»¿ÉÎ»Ñ°Ö·£¬Ã¿Ò»¸öÎ»¶¼ÓÐÏàÓ¦µÄº¬Òå£¬
 112   1              TMOD&=0xF0;//ÉÏÃæµÄÐ´·¨¿ÉÄÜ´æÔÚÓëÁíÒ»¸ö¶¨Ê±Æ÷³åÍ»µÄÇé¿ö£»
 113   1              TMOD|=0x01;//ÓÃ&|µÄ·½Ê½¸³Öµ²»»áÓ°ÏìÁíÒ»¸ö¶¨Ê±Æ÷µÄÔËÐÐ
 114   1              TF0=0;//Ä¬ÈÏÓ¦¸ÃÊÇ0²»ÅäÖÃ²»Ó°Ïì£¬±ÜÃâÒ»¿ªÊ¼¾Í²úÉúÖÐ¶Ï;
 115   1              TH0=64535/256;//¸ß°ËÎ»Êý¾Ý     ¾§Õñ12mhz£¬Ò»¸öÖÜÆÚÎª1us£¬×î´ó65535us£¬
C51 COMPILER V9.54   C51TANGSANG                                                           02/16/2023 23:16:31 PAGE 3   

 116   1              TL0=64535%256;//µÍ°ËÎ»Êý¾Ý->64535 = 65535-1000; -> 1000us=1ms; ¶¨Ê±Æ÷µ¥Î»Îª1ms
 117   1              ET0=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 118   1              EA=1;
 119   1              PT0=0;
 120   1              TR0=1;//Ä¬ÈÏ»¹ÊÇ°Ñ¼ÆÊ±Æ÷´ò¿ª£»
 121   1      }
 122          
 123          void time_1_ms_init()
 124          {
 125   1              TMOD&=0x0F;
 126   1              TMOD|=0x10;
 127   1              TL1=64535%256;
 128   1              TH1=64535/256;
 129   1              TF1=0;//ÉèÖÃÄ¬ÈÏÎªÎ´Òç³ö        
 130   1      
 131   1      //      IE1=1;//ÖÐ¶Ï¿ª¹Ø
 132   1      //      IT1=1;
 133   1              
 134   1              ET1=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 135   1              EA=1;
 136   1              PT1=0;
 137   1              
 138   1              TR1=1;//¶¨Ê±Æ÷1¿ªÊ¼ÔËÐÐ
 139   1      }
 140          
 141          void time_1_us_init()
 142          {
 143   1              TMOD&=0x0F;
 144   1              TMOD|=0x10;
 145   1              TL1=65534%256;
 146   1              TH1=65534/256;
 147   1              TF1=0;//ÉèÖÃÄ¬ÈÏÎªÎ´Òç³ö        
 148   1      
 149   1      //      IE1=1;//ÖÐ¶Ï¿ª¹Ø
 150   1      //      IT1=1;
 151   1              
 152   1              ET1=1;//Èý¸öÖÐ¶ÏÏµÍ³µÄ½Ó¿Ú
 153   1              EA=1;
 154   1              PT1=0;
 155   1              
 156   1              TR1=1;//¶¨Ê±Æ÷1¿ªÊ¼ÔËÐÐ
 157   1      }
 158          
 159          void time_0_us_init()
 160          {
 161   1              //TMOD = 0x01;//¹¤×÷Ä£Ê½£¬²»¿ÉÎ»Ñ°Ö·£¬Ã¿Ò»¸öÎ»¶¼ÓÐÏàÓ¦µÄº¬Òå£¬
 162   1              TMOD&=0xF0;//ÉÏÃæµÄÐ´·¨¿ÉÄÜ´æÔÚÓëÁíÒ»¸ö¶¨Ê±Æ÷³åÍ»µÄÇé¿ö£»
 163   1              TMOD|=0x01;//ÓÃ&|µÄ·½Ê½¸³Öµ²»»áÓ°ÏìÁíÒ»¸ö¶¨Ê±Æ÷µÄÔËÐÐ
 164   1              TF0=0;//Ä¬ÈÏÓ¦¸ÃÊÇ0²»ÅäÖÃ²»Ó°Ïì£¬±ÜÃâÒ»¿ªÊ¼¾Í²úÉúÖÐ¶Ï;
 165   1              TH0=65534/256;//¸ß°ËÎ»Êý¾Ý     ¾§Õñ12mhz£¬Ò»¸öÖÜÆÚÎª1us£¬×î´ó65535us£¬
 166   1              TL0=65534%256;//µÍ°ËÎ»Êý¾Ý->64535 = 65535-1000; -> 1000us=1ms; ¶¨Ê±Æ÷µ¥Î»Îª1ms
 167   1              
 168   1              ET0=1;//time0ÖÐ¶Ï¿ØÖÆÎ»
 169   1              EA=1; //ÖÐ¶Ï×Ü¿ª¹Ø
 170   1              PT0=1;//ÖÐ¶ÏÓÅÏÈ¼¶ 0---->µÍ
 171   1              TR0=1;//¶¨Ê±Æ÷¿ªÊ¼±êÖ¾
 172   1      
 173   1      }
 174          
 175          //¶ÁÈ¡¶ÀÁ¢°´¼ü×´Ì¬
 176          uint buttom_getstate_4()
 177          {
C51 COMPILER V9.54   C51TANGSANG                                                           02/16/2023 23:16:31 PAGE 4   

 178   1              if(P3_0==0)
 179   1              {
 180   2                      delay(20);while(P3_0==0);delay(20);return 2;
 181   2              }
 182   1              if(P3_1==0)
 183   1              {
 184   2                      delay(10);while(P3_1==0);delay(20);return 1;
 185   2              }
 186   1              if(P3_2==0)
 187   1              {
 188   2                      delay(10);while(P3_2==0);delay(20);return 3;
 189   2              }
 190   1              if(P3_3==0)
 191   1              {
 192   2                      delay(10);while(P3_3==0);delay(20);return 4;
 193   2              }
 194   1              return 0;
 195   1      }
 196          
 197          int buttom_getstate_16()
 198          {
 199   1          int state=0;
 200   1          P1=0xFF;
 201   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 202   1          P1_3=0;
 203   1          //¾ØÕó¼üÅÌµÚÒ»ÁÐ--->ÅÐ¶Ï×î×ó±ßÁÐ
 204   1          if(P1_7==0){ delay(50);while(P1_7==0);delay(20);state=1;}
 205   1          if(P1_6==0){ delay(50);while(P1_7==0);delay(20);state=5;}
 206   1          if(P1_5==0){ delay(50);while(P1_7==0);delay(20);state= 9;}
 207   1          if(P1_4==0){ delay(50);while(P1_7==0);delay(20);state= 13;}
 208   1      
 209   1          P1=0xFF;
 210   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 211   1          P1_2=0;
 212   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0100
 213   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 2;}
 214   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 6;}
 215   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 10;}
 216   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 14;}
 217   1      
 218   1          P1=0xFF;
 219   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 220   1          P1_1=0;
 221   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0010
 222   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 3;}
 223   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 7;}
 224   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 11;}
 225   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 15;}
 226   1      
 227   1          P1=0xFF;
 228   1          //ÏÈ°ÑP1È«²¿ÖÃ1£¬È»ºó¸ø¶ÔÓ¦io¸ø0£¬Ò»´ÎÅÐ¶Ï
 229   1          P1_0=0;
 230   1          //¾ØÕó¼üÅÌµÚ¶þÁÐ--->0001
 231   1          if(P1_7==0){ delay(20);while(P1_7==0);delay(20);state= 4;}
 232   1          if(P1_6==0){ delay(20);while(P1_7==0);delay(20);state= 8;}
 233   1          if(P1_5==0){ delay(20);while(P1_7==0);delay(20);state= 12;}
 234   1          if(P1_4==0){ delay(20);while(P1_7==0);delay(20);state= 16;}
 235   1      
 236   1          return state;
 237   1      }
 238          //4800²¨ÌØÂÊ´®¿Ú³õÊ¼»¯
 239          void uart_init()                //4800bps@11.0592MHz
C51 COMPILER V9.54   C51TANGSANG                                                           02/16/2023 23:16:31 PAGE 5   

 240          {
 241   1          PCON &= 0x7F;               //²¨ÌØÂÊ²»±¶ËÙ
 242   1          SCON = 0x50;                //8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
 243   1      //    AUXR &= 0xBF;             //¶¨Ê±Æ÷1Ê±ÖÓÎªFosc/12,¼´12T
 244   1      //    AUXR &= 0xFE;             //´®¿Ú1Ñ¡Ôñ¶¨Ê±Æ÷1Îª²¨ÌØÂÊ·¢ÉúÆ÷
 245   1          TMOD &= 0x0F;               //Çå³ý¶¨Ê±Æ÷1Ä£Ê½Î»
 246   1          TMOD |= 0x20;               //Éè¶¨¶¨Ê±Æ÷1Îª8Î»×Ô¶¯ÖØ×°·½Ê½
 247   1          TL1 = 0xFA;         //Éè¶¨¶¨Ê±³õÖµ
 248   1          TH1 = 0xFA;         //Éè¶¨¶¨Ê±Æ÷ÖØ×°Öµ
 249   1          ET1 = 0;            //½ûÖ¹¶¨Ê±Æ÷1ÖÐ¶Ï
 250   1          TR1 = 1;            //Æô¶¯¶¨Ê±Æ÷1
 251   1          EA = 1;    //Æô¶¯ËùÓÐÖÐ¶Ï
 252   1          ES = 1;    //Æô¶¯´®¿ÚÖÐ¶Ï
 253   1      }
 254          
 255          //µ¥Æ¬»ú·¢ËÍÊý¾Ý
 256          void uart_sendbyte(unsigned char byte)
 257          {
 258   1          SBUF=byte;
 259   1          while(TI==0);
 260   1          TI=0;
 261   1      }
 262          
 263          //void uart_getdata() interrupt 4
 264          //{
 265          //    if(RI==1)//µ¥Æ¬»ú½ÓÊÕµ½Êý¾Ý·¢ÉúÖÐ¶Ï
 266          //    {
 267          //        RI=0;//Èí¼þÖØÖÃÖÐ¶Ï¿ª¹Ø
 268          //        date_uart=SBUF;//½ÓÊÕÊý¾Ý
 269          //    }
 270          //}
 271          //uart½ÓÊÕÊý¾Ý


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    787    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
